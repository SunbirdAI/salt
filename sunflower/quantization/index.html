<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://salt.sunbird.ai/sunflower/quantization/ rel=canonical><link href=../inference/ rel=prev><link href=../../tutorials/04-basics/ rel=next><link rel=icon href=../../assets/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>LoRA Fine-tuned Models to GGUF - SALT Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7COpen+Sans+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Open Sans";--md-code-font:"Open Sans Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../stylesheets/custom.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=amber> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#converting-sunflower-lora-fine-tuned-models-to-gguf-quantizations class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="SALT Documentation" class="md-header__button md-logo" aria-label="SALT Documentation" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> SALT Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> LoRA Fine-tuned Models to GGUF </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=amber aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=amber aria-label="Switch to system preference" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/SunbirdAI/salt title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> SunbirdAI/salt </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> SALT </a> </li> <li class=md-tabs__item> <a href=../../tutorials/01-introduction/ class=md-tabs__link> Getting Started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../sunflower/ class=md-tabs__link> Sunflower </a> </li> <li class=md-tabs__item> <a href=../../tutorials/04-basics/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../API/ class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=../../reference/ class=md-tabs__link> Reference </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="SALT Documentation" class="md-nav__button md-logo" aria-label="SALT Documentation" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> SALT Documentation </label> <div class=md-nav__source> <a href=https://github.com/SunbirdAI/salt title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> SunbirdAI/salt </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> SALT </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tutorials/01-introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../tutorials/02-installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Sunflower </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Sunflower </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../sunflower/ class=md-nav__link> <span class=md-ellipsis> Getting started </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> Quantization </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Quantization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../inference/ class=md-nav__link> <span class=md-ellipsis> inference </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> LoRA Fine-tuned Models to GGUF </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> LoRA Fine-tuned Models to GGUF </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> <nav class=md-nav aria-label=Prerequisites> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hardware-requirements class=md-nav__link> <span class=md-ellipsis> Hardware Requirements </span> </a> </li> <li class=md-nav__item> <a href=#software-requirements class=md-nav__link> <span class=md-ellipsis> Software Requirements </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#environment-setup class=md-nav__link> <span class=md-ellipsis> Environment Setup </span> </a> <nav class=md-nav aria-label="Environment Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-install-dependencies class=md-nav__link> <span class=md-ellipsis> 1. Install Dependencies </span> </a> </li> <li class=md-nav__item> <a href=#2-clone-and-build-llamacpp class=md-nav__link> <span class=md-ellipsis> 2. Clone and Build llama.cpp </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#model-preparation class=md-nav__link> <span class=md-ellipsis> Model Preparation </span> </a> <nav class=md-nav aria-label="Model Preparation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-download-models class=md-nav__link> <span class=md-ellipsis> 1. Download Models </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lora-merging class=md-nav__link> <span class=md-ellipsis> LoRA Merging </span> </a> <nav class=md-nav aria-label="LoRA Merging"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2-run-merge-process class=md-nav__link> <span class=md-ellipsis> 2. Run Merge Process </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#gguf-conversion class=md-nav__link> <span class=md-ellipsis> GGUF Conversion </span> </a> <nav class=md-nav aria-label="GGUF Conversion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-convert-to-f16-gguf class=md-nav__link> <span class=md-ellipsis> 1. Convert to F16 GGUF </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#quantization-process class=md-nav__link> <span class=md-ellipsis> Quantization Process </span> </a> <nav class=md-nav aria-label="Quantization Process"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-generate-importance-matrix class=md-nav__link> <span class=md-ellipsis> 1. Generate Importance Matrix </span> </a> </li> <li class=md-nav__item> <a href=#2-standard-quantizations class=md-nav__link> <span class=md-ellipsis> 2. Standard Quantizations </span> </a> </li> <li class=md-nav__item> <a href=#3-quantization-options-reference class=md-nav__link> <span class=md-ellipsis> 3. Quantization Options Reference </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#experimental-quantizations class=md-nav__link> <span class=md-ellipsis> Experimental Quantizations </span> </a> <nav class=md-nav aria-label="Experimental Quantizations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ultra-low-bit-quantizations class=md-nav__link> <span class=md-ellipsis> Ultra-Low Bit Quantizations </span> </a> </li> <li class=md-nav__item> <a href=#experimental-quantization-reference class=md-nav__link> <span class=md-ellipsis> Experimental Quantization Reference </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#quality-testing class=md-nav__link> <span class=md-ellipsis> Quality Testing </span> </a> <nav class=md-nav aria-label="Quality Testing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-quick-functionality-test class=md-nav__link> <span class=md-ellipsis> 1. Quick Functionality Test </span> </a> </li> <li class=md-nav__item> <a href=#2-perplexity-evaluation class=md-nav__link> <span class=md-ellipsis> 2. Perplexity Evaluation </span> </a> </li> <li class=md-nav__item> <a href=#3-size-verification class=md-nav__link> <span class=md-ellipsis> 3. Size Verification </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ollama-integration class=md-nav__link> <span class=md-ellipsis> Ollama Integration </span> </a> <nav class=md-nav aria-label="Ollama Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installation-and-setup class=md-nav__link> <span class=md-ellipsis> Installation and Setup </span> </a> </li> <li class=md-nav__item> <a href=#creating-modelfiles-for-different-quantizations class=md-nav__link> <span class=md-ellipsis> Creating Modelfiles for Different Quantizations </span> </a> </li> <li class=md-nav__item> <a href=#importing-models-to-ollama class=md-nav__link> <span class=md-ellipsis> Importing Models to Ollama </span> </a> </li> <li class=md-nav__item> <a href=#using-ollama-models class=md-nav__link> <span class=md-ellipsis> Using Ollama Models </span> </a> </li> <li class=md-nav__item> <a href=#ollama-api-usage class=md-nav__link> <span class=md-ellipsis> Ollama API Usage </span> </a> </li> <li class=md-nav__item> <a href=#model-management class=md-nav__link> <span class=md-ellipsis> Model Management </span> </a> </li> <li class=md-nav__item> <a href=#performance-comparison-script class=md-nav__link> <span class=md-ellipsis> Performance Comparison Script </span> </a> </li> <li class=md-nav__item> <a href=#production-deployment class=md-nav__link> <span class=md-ellipsis> Production Deployment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#distribution class=md-nav__link> <span class=md-ellipsis> Distribution </span> </a> <nav class=md-nav aria-label=Distribution> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-hugging-face-upload class=md-nav__link> <span class=md-ellipsis> 1. Hugging Face Upload </span> </a> </li> <li class=md-nav__item> <a href=#2-ollama-integration-complete-guide class=md-nav__link> <span class=md-ellipsis> 2. Ollama Integration (Complete Guide) </span> </a> <nav class=md-nav aria-label="2. Ollama Integration (Complete Guide)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installation-and-setup_1 class=md-nav__link> <span class=md-ellipsis> Installation and Setup </span> </a> </li> <li class=md-nav__item> <a href=#creating-modelfiles-for-different-quantizations_1 class=md-nav__link> <span class=md-ellipsis> Creating Modelfiles for Different Quantizations </span> </a> </li> <li class=md-nav__item> <a href=#importing-models-to-ollama_1 class=md-nav__link> <span class=md-ellipsis> Importing Models to Ollama </span> </a> </li> <li class=md-nav__item> <a href=#using-ollama-models_1 class=md-nav__link> <span class=md-ellipsis> Using Ollama Models </span> </a> </li> <li class=md-nav__item> <a href=#ollama-api-usage_1 class=md-nav__link> <span class=md-ellipsis> Ollama API Usage </span> </a> </li> <li class=md-nav__item> <a href=#model-management_1 class=md-nav__link> <span class=md-ellipsis> Model Management </span> </a> </li> <li class=md-nav__item> <a href=#performance-comparison-script_1 class=md-nav__link> <span class=md-ellipsis> Performance Comparison Script </span> </a> </li> <li class=md-nav__item> <a href=#troubleshooting-ollama class=md-nav__link> <span class=md-ellipsis> Troubleshooting Ollama </span> </a> </li> <li class=md-nav__item> <a href=#production-deployment_1 class=md-nav__link> <span class=md-ellipsis> Production Deployment </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common-issues class=md-nav__link> <span class=md-ellipsis> Common Issues </span> </a> </li> <li class=md-nav__item> <a href=#file-size-expectations class=md-nav__link> <span class=md-ellipsis> File Size Expectations </span> </a> </li> <li class=md-nav__item> <a href=#performance-notes class=md-nav__link> <span class=md-ellipsis> Performance Notes </span> </a> </li> <li class=md-nav__item> <a href=#ollama-specific-issues class=md-nav__link> <span class=md-ellipsis> Ollama-Specific Issues </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> <span class=md-ellipsis> References </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> Beginner </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Beginner </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tutorials/04-basics/ class=md-nav__link> <span class=md-ellipsis> Basics </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../tutorials/07-speech-datasets/ class=md-nav__link> <span class=md-ellipsis> SALT Datasets </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> SALT Models </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> SALT Models </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tutorials/08-translation-models/ class=md-nav__link> <span class=md-ellipsis> Translation Models </span> </a> </li> <li class=md-nav__item> <a href=../../tutorials/09-asr-models/ class=md-nav__link> <span class=md-ellipsis> ASR Models </span> </a> </li> <li class=md-nav__item> <a href=../../tutorials/10-tts-spark-models/ class=md-nav__link> <span class=md-ellipsis> TTS Models </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> SALT Pipelines </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> SALT Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tutorials/11-data-loading/ class=md-nav__link> <span class=md-ellipsis> Data Loading </span> </a> </li> <li class=md-nav__item> <a href=../../tutorials/12-training/ class=md-nav__link> <span class=md-ellipsis> Training </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> Speaker Diarization </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Speaker Diarization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tutorials/13-diarization/ class=md-nav__link> <span class=md-ellipsis> Diarization </span> </a> </li> <li class=md-nav__item> <a href=../../tutorials/14-diarization-training/ class=md-nav__link> <span class=md-ellipsis> Fine-Tuning Diarization </span> </a> </li> <li class=md-nav__item> <a href=../../tutorials/15-diarization-evaluation/ class=md-nav__link> <span class=md-ellipsis> Diarization evaluation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../../API/ class="md-nav__link "> <span class=md-ellipsis> API </span> </a> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> API </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/ class=md-nav__link> <span class=md-ellipsis> Reference </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> <nav class=md-nav aria-label=Prerequisites> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hardware-requirements class=md-nav__link> <span class=md-ellipsis> Hardware Requirements </span> </a> </li> <li class=md-nav__item> <a href=#software-requirements class=md-nav__link> <span class=md-ellipsis> Software Requirements </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#environment-setup class=md-nav__link> <span class=md-ellipsis> Environment Setup </span> </a> <nav class=md-nav aria-label="Environment Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-install-dependencies class=md-nav__link> <span class=md-ellipsis> 1. Install Dependencies </span> </a> </li> <li class=md-nav__item> <a href=#2-clone-and-build-llamacpp class=md-nav__link> <span class=md-ellipsis> 2. Clone and Build llama.cpp </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#model-preparation class=md-nav__link> <span class=md-ellipsis> Model Preparation </span> </a> <nav class=md-nav aria-label="Model Preparation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-download-models class=md-nav__link> <span class=md-ellipsis> 1. Download Models </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lora-merging class=md-nav__link> <span class=md-ellipsis> LoRA Merging </span> </a> <nav class=md-nav aria-label="LoRA Merging"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2-run-merge-process class=md-nav__link> <span class=md-ellipsis> 2. Run Merge Process </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#gguf-conversion class=md-nav__link> <span class=md-ellipsis> GGUF Conversion </span> </a> <nav class=md-nav aria-label="GGUF Conversion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-convert-to-f16-gguf class=md-nav__link> <span class=md-ellipsis> 1. Convert to F16 GGUF </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#quantization-process class=md-nav__link> <span class=md-ellipsis> Quantization Process </span> </a> <nav class=md-nav aria-label="Quantization Process"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-generate-importance-matrix class=md-nav__link> <span class=md-ellipsis> 1. Generate Importance Matrix </span> </a> </li> <li class=md-nav__item> <a href=#2-standard-quantizations class=md-nav__link> <span class=md-ellipsis> 2. Standard Quantizations </span> </a> </li> <li class=md-nav__item> <a href=#3-quantization-options-reference class=md-nav__link> <span class=md-ellipsis> 3. Quantization Options Reference </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#experimental-quantizations class=md-nav__link> <span class=md-ellipsis> Experimental Quantizations </span> </a> <nav class=md-nav aria-label="Experimental Quantizations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ultra-low-bit-quantizations class=md-nav__link> <span class=md-ellipsis> Ultra-Low Bit Quantizations </span> </a> </li> <li class=md-nav__item> <a href=#experimental-quantization-reference class=md-nav__link> <span class=md-ellipsis> Experimental Quantization Reference </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#quality-testing class=md-nav__link> <span class=md-ellipsis> Quality Testing </span> </a> <nav class=md-nav aria-label="Quality Testing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-quick-functionality-test class=md-nav__link> <span class=md-ellipsis> 1. Quick Functionality Test </span> </a> </li> <li class=md-nav__item> <a href=#2-perplexity-evaluation class=md-nav__link> <span class=md-ellipsis> 2. Perplexity Evaluation </span> </a> </li> <li class=md-nav__item> <a href=#3-size-verification class=md-nav__link> <span class=md-ellipsis> 3. Size Verification </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ollama-integration class=md-nav__link> <span class=md-ellipsis> Ollama Integration </span> </a> <nav class=md-nav aria-label="Ollama Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installation-and-setup class=md-nav__link> <span class=md-ellipsis> Installation and Setup </span> </a> </li> <li class=md-nav__item> <a href=#creating-modelfiles-for-different-quantizations class=md-nav__link> <span class=md-ellipsis> Creating Modelfiles for Different Quantizations </span> </a> </li> <li class=md-nav__item> <a href=#importing-models-to-ollama class=md-nav__link> <span class=md-ellipsis> Importing Models to Ollama </span> </a> </li> <li class=md-nav__item> <a href=#using-ollama-models class=md-nav__link> <span class=md-ellipsis> Using Ollama Models </span> </a> </li> <li class=md-nav__item> <a href=#ollama-api-usage class=md-nav__link> <span class=md-ellipsis> Ollama API Usage </span> </a> </li> <li class=md-nav__item> <a href=#model-management class=md-nav__link> <span class=md-ellipsis> Model Management </span> </a> </li> <li class=md-nav__item> <a href=#performance-comparison-script class=md-nav__link> <span class=md-ellipsis> Performance Comparison Script </span> </a> </li> <li class=md-nav__item> <a href=#production-deployment class=md-nav__link> <span class=md-ellipsis> Production Deployment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#distribution class=md-nav__link> <span class=md-ellipsis> Distribution </span> </a> <nav class=md-nav aria-label=Distribution> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-hugging-face-upload class=md-nav__link> <span class=md-ellipsis> 1. Hugging Face Upload </span> </a> </li> <li class=md-nav__item> <a href=#2-ollama-integration-complete-guide class=md-nav__link> <span class=md-ellipsis> 2. Ollama Integration (Complete Guide) </span> </a> <nav class=md-nav aria-label="2. Ollama Integration (Complete Guide)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installation-and-setup_1 class=md-nav__link> <span class=md-ellipsis> Installation and Setup </span> </a> </li> <li class=md-nav__item> <a href=#creating-modelfiles-for-different-quantizations_1 class=md-nav__link> <span class=md-ellipsis> Creating Modelfiles for Different Quantizations </span> </a> </li> <li class=md-nav__item> <a href=#importing-models-to-ollama_1 class=md-nav__link> <span class=md-ellipsis> Importing Models to Ollama </span> </a> </li> <li class=md-nav__item> <a href=#using-ollama-models_1 class=md-nav__link> <span class=md-ellipsis> Using Ollama Models </span> </a> </li> <li class=md-nav__item> <a href=#ollama-api-usage_1 class=md-nav__link> <span class=md-ellipsis> Ollama API Usage </span> </a> </li> <li class=md-nav__item> <a href=#model-management_1 class=md-nav__link> <span class=md-ellipsis> Model Management </span> </a> </li> <li class=md-nav__item> <a href=#performance-comparison-script_1 class=md-nav__link> <span class=md-ellipsis> Performance Comparison Script </span> </a> </li> <li class=md-nav__item> <a href=#troubleshooting-ollama class=md-nav__link> <span class=md-ellipsis> Troubleshooting Ollama </span> </a> </li> <li class=md-nav__item> <a href=#production-deployment_1 class=md-nav__link> <span class=md-ellipsis> Production Deployment </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common-issues class=md-nav__link> <span class=md-ellipsis> Common Issues </span> </a> </li> <li class=md-nav__item> <a href=#file-size-expectations class=md-nav__link> <span class=md-ellipsis> File Size Expectations </span> </a> </li> <li class=md-nav__item> <a href=#performance-notes class=md-nav__link> <span class=md-ellipsis> Performance Notes </span> </a> </li> <li class=md-nav__item> <a href=#ollama-specific-issues class=md-nav__link> <span class=md-ellipsis> Ollama-Specific Issues </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> <span class=md-ellipsis> References </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/SunbirdAI/salt/edit/master/docs/sunflower/quantization.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/SunbirdAI/salt/raw/master/docs/sunflower/quantization.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=converting-sunflower-lora-fine-tuned-models-to-gguf-quantizations>Converting Sunflower LoRA Fine-tuned Models to GGUF Quantizations<a class=headerlink href=#converting-sunflower-lora-fine-tuned-models-to-gguf-quantizations title="Permanent link">&para;</a></h1> <p>In this guide, provide a tutorial for converting LoRA fine-tuned Sunflower models to GGUF format with multiple quantization levels, including experimental ultra-low bit quantizations.</p> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <ul> <li><a href=#prerequisites>Prerequisites</a></li> <li><a href=#environment-setup>Environment Setup</a></li> <li><a href=#model-preparation>Model Preparation</a></li> <li><a href=#lora-merging>LoRA Merging</a></li> <li><a href=#gguf-conversion>GGUF Conversion</a></li> <li><a href=#quantization-process>Quantization Process</a></li> <li><a href=#experimental-quantizations>Experimental Quantizations</a></li> <li><a href=#quality-testing>Quality Testing</a></li> <li><a href=#ollama-integration>Ollama Integration</a></li> <li><a href=#distribution>Distribution</a></li> <li><a href=#troubleshooting>Troubleshooting</a></li> </ul> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <h3 id=hardware-requirements>Hardware Requirements<a class=headerlink href=#hardware-requirements title="Permanent link">&para;</a></h3> <ul> <li><strong>RAM</strong>: Minimum 32GB (64GB recommended for 14B+ models)</li> <li><strong>Storage</strong>: 200GB+ free space for intermediate files</li> <li><strong>GPU</strong>: Optional but recommended for faster processing</li> </ul> <h3 id=software-requirements>Software Requirements<a class=headerlink href=#software-requirements title="Permanent link">&para;</a></h3> <ul> <li>Linux/macOS (WSL2 for Windows)</li> <li>Python 3.9+</li> <li>Git and Git LFS</li> <li>CUDA toolkit (optional, for GPU acceleration)</li> </ul> <h2 id=environment-setup>Environment Setup<a class=headerlink href=#environment-setup title="Permanent link">&para;</a></h2> <h3 id=1-install-dependencies>1. Install Dependencies<a class=headerlink href=#1-install-dependencies title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># Install Python packages</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>pip<span class=w> </span>install<span class=w> </span>torch<span class=w> </span>transformers<span class=w> </span>accelerate
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>pip<span class=w> </span>install<span class=w> </span>sentencepiece<span class=w> </span>protobuf
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>pip<span class=w> </span>install<span class=w> </span>peft<span class=w> </span>huggingface_hub
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>pip<span class=w> </span>install<span class=w> </span>-U<span class=w> </span>huggingface_hub
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=c1># Install system dependencies (Ubuntu/Debian)</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>sudo<span class=w> </span>apt<span class=w> </span>update
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>cmake<span class=w> </span>build-essential<span class=w> </span>git<span class=w> </span>git-lfs
</span></code></pre></div> <h3 id=2-clone-and-build-llamacpp>2. Clone and Build llama.cpp<a class=headerlink href=#2-clone-and-build-llamacpp title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># Clone llama.cpp</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/ggml-org/llama.cpp
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=nb>cd</span><span class=w> </span>llama.cpp
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1># Build with CUDA support (if available)</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>cmake<span class=w> </span>-B<span class=w> </span>build<span class=w> </span>-DGGML_CUDA<span class=o>=</span>ON
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>cmake<span class=w> </span>--build<span class=w> </span>build<span class=w> </span>--config<span class=w> </span>Release
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=c1># OR build for CPU only</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>make<span class=w> </span>clean<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>make
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=c1># Create working directories</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>mkdir<span class=w> </span>-p<span class=w> </span>models<span class=w> </span>gguf_outputs
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=nb>cd</span><span class=w> </span>..
</span></code></pre></div> <h2 id=model-preparation>Model Preparation<a class=headerlink href=#model-preparation title="Permanent link">&para;</a></h2> <h3 id=1-download-models>1. Download Models<a class=headerlink href=#1-download-models title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># Download base model</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>huggingface-cli<span class=w> </span>download<span class=w> </span>jq/sunflower-14b-bs64-lr1e-4<span class=w> </span>--local-dir<span class=w> </span>models/base_model
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=c1># Download LoRA adapter</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>huggingface-cli<span class=w> </span>download<span class=w> </span>jq/qwen3-14b-sunflower-20250915<span class=w> </span>--local-dir<span class=w> </span>models/lora_model
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=c1># Download merged model (LoRA already merged)</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>huggingface-cli<span class=w> </span>download<span class=w> </span>Sunbird/qwen3-14b-sunflower-merged<span class=w> </span>--local-dir<span class=w> </span>models/merged_model
</span></code></pre></div> <p><strong>Example:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>huggingface-cli<span class=w> </span>download<span class=w> </span>jq/sunflower-14b-bs64-lr1e-4<span class=w> </span>--local-dir<span class=w> </span>models/base_model
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>huggingface-cli<span class=w> </span>download<span class=w> </span>jq/qwen3-14b-sunflower-20250915<span class=w> </span>--local-dir<span class=w> </span>models/lora_model
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=c1># Download merged model (LoRA already merged)</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>huggingface-cli<span class=w> </span>download<span class=w> </span>Sunbird/qwen3-14b-sunflower-merged<span class=w> </span>--local-dir<span class=w> </span>models/merged_model
</span></code></pre></div> <h2 id=lora-merging>LoRA Merging<a class=headerlink href=#lora-merging title="Permanent link">&para;</a></h2> <ol> <li>Create Merge Script (Skip if Using Pre-merged Model) Note: If you downloaded Sunbird/qwen3-14b-sunflower-merged, skip this section and go directly to GGUF Conversion. Create merge_lora.py only if using separate base model and LoRA adapter:</li> </ol> <p>Create <code>merge_lora.py</code>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=ch>#!/usr/bin/env python3</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=sd>Merge LoRA adapter with base model</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=kn>from</span><span class=w> </span><span class=nn>transformers</span><span class=w> </span><span class=kn>import</span> <span class=n>AutoModelForCausalLM</span><span class=p>,</span> <span class=n>AutoTokenizer</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=kn>from</span><span class=w> </span><span class=nn>peft</span><span class=w> </span><span class=kn>import</span> <span class=n>PeftModel</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=kn>import</span><span class=w> </span><span class=nn>torch</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=kn>import</span><span class=w> </span><span class=nn>sys</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=k>def</span><span class=w> </span><span class=nf>merge_lora_model</span><span class=p>():</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Loading base model...&quot;</span><span class=p>)</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>    <span class=n>base_model</span> <span class=o>=</span> <span class=n>AutoModelForCausalLM</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>        <span class=s2>&quot;models/base_model&quot;</span><span class=p>,</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>        <span class=n>torch_dtype</span><span class=o>=</span><span class=n>torch</span><span class=o>.</span><span class=n>bfloat16</span><span class=p>,</span>  <span class=c1># Use bfloat16 for better precision</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>        <span class=n>device_map</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>,</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>        <span class=n>low_cpu_mem_usage</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>    <span class=p>)</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Loading LoRA adapter...&quot;</span><span class=p>)</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>    <span class=n>model</span> <span class=o>=</span> <span class=n>PeftModel</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span><span class=n>base_model</span><span class=p>,</span> <span class=s2>&quot;models/lora_model&quot;</span><span class=p>)</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Merging LoRA with base model...&quot;</span><span class=p>)</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>    <span class=n>merged_model</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>merge_and_unload</span><span class=p>()</span>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Saving merged model...&quot;</span><span class=p>)</span>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>    <span class=n>merged_model</span><span class=o>.</span><span class=n>save_pretrained</span><span class=p>(</span><span class=s2>&quot;models/merged_model&quot;</span><span class=p>,</span> <span class=n>safe_serialization</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>    <span class=c1># Save tokenizer</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Saving tokenizer...&quot;</span><span class=p>)</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>    <span class=n>tokenizer</span> <span class=o>=</span> <span class=n>AutoTokenizer</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span><span class=s2>&quot;models/base_model&quot;</span><span class=p>)</span>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>    <span class=n>tokenizer</span><span class=o>.</span><span class=n>save_pretrained</span><span class=p>(</span><span class=s2>&quot;models/merged_model&quot;</span><span class=p>)</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Merge completed successfully!&quot;</span><span class=p>)</span>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Merged model saved to: models/merged_model&quot;</span><span class=p>)</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span>
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>    <span class=n>merge_lora_model</span><span class=p>()</span>
</span></code></pre></div> <h3 id=2-run-merge-process>2. Run Merge Process<a class=headerlink href=#2-run-merge-process title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>python<span class=w> </span>merge_lora.py
</span></code></pre></div> <p><strong>Expected output</strong>: Merged model saved to <code>models/merged_model</code></p> <h2 id=gguf-conversion>GGUF Conversion<a class=headerlink href=#gguf-conversion title="Permanent link">&para;</a></h2> <h3 id=1-convert-to-f16-gguf>1. Convert to F16 GGUF<a class=headerlink href=#1-convert-to-f16-gguf title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># Convert merged model to F16 GGUF (preserves quality for quantization)</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>python3<span class=w> </span>llama.cpp/convert_hf_to_gguf.py<span class=w> </span>models/merged_model<span class=w> </span><span class=se>\</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>  </span>--outfile<span class=w> </span>gguf_outputs/model-merged-f16.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>  </span>--outtype<span class=w> </span>f16
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=c1># Verify file size (should be ~2GB per billion parameters for F16)</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>ls<span class=w> </span>-lh<span class=w> </span>gguf_outputs/model-merged-f16.gguf
</span></code></pre></div> <p><strong>Expected size</strong>: ~28GB for 14B model in F16</p> <h2 id=quantization-process>Quantization Process<a class=headerlink href=#quantization-process title="Permanent link">&para;</a></h2> <h3 id=1-generate-importance-matrix>1. Generate Importance Matrix<a class=headerlink href=#1-generate-importance-matrix title="Permanent link">&para;</a></h3> <p>The importance matrix (imatrix) significantly improves quantization quality by identifying which weights are most critical to model performance.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># Download calibration dataset</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>wget<span class=w> </span><span class=o>[</span>https://raw.githubusercontent.com/ggerganov/llama.cpp/master/examples/perplexity/wiki.test.raw<span class=o>](</span>https://huggingface.co/nisten/llama3-8b-instruct-32k-gguf/raw/main/wiki.test.raw<span class=o>)</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=c1># Generate importance matrix (this takes 30-60 minutes)</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>./llama.cpp/build/bin/llama-imatrix<span class=w> </span><span class=se>\</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>  </span>-m<span class=w> </span>gguf_outputs/model-merged-f16.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>  </span>-f<span class=w> </span>wiki.test.raw<span class=w> </span><span class=se>\</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>  </span>--chunk<span class=w> </span><span class=m>512</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>  </span>-o<span class=w> </span>gguf_outputs/model-imatrix.dat<span class=w> </span><span class=se>\</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>  </span>-ngl<span class=w> </span><span class=m>32</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>  </span>--verbose
</span></code></pre></div> <p><strong>Note</strong>: Adjust <code>-ngl</code> based on your GPU memory (0 for CPU-only)</p> <blockquote> <p><strong>Note: Understanding Importance Matrix (imatrix)</strong></p> <p>The importance matrix is a calibration technique that identifies which model weights contribute most significantly to output quality. During quantization, weights deemed "important" by the matrix receive higher precision allocation, while less critical weights can be more aggressively compressed. This selective approach significantly improves quantized model quality compared to uniform quantization.</p> <p>The imatrix is generated by running representative text through the model and measuring activation patterns. While general text datasets (like WikiText) work well for most models, using domain-specific calibration data (e.g., translation examples for the Sunflower model) can provide marginal quality improvements. The process adds 30-60 minutes to quantization time but is highly recommended for production models, especially when using aggressive quantizations like Q4_K_M and below.</p> </blockquote> <h3 id=2-standard-quantizations>2. Standard Quantizations<a class=headerlink href=#2-standard-quantizations title="Permanent link">&para;</a></h3> <p>Create quantized models with different quality/size trade-offs:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># Q8_0: Near-lossless quality (~15GB for 14B model)</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>./llama.cpp/build/bin/llama-quantize<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>  </span>--imatrix<span class=w> </span>gguf_outputs/model-imatrix.dat<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>  </span>gguf_outputs/model-merged-f16.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>  </span>gguf_outputs/model-q8_0.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>  </span>Q8_0
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=c1># Q6_K: High quality (~12GB for 14B model)</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>./llama.cpp/build/bin/llama-quantize<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>  </span>--imatrix<span class=w> </span>gguf_outputs/model-imatrix.dat<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=w>  </span>gguf_outputs/model-merged-f16.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=w>  </span>gguf_outputs/model-q6_k.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=w>  </span>Q6_K
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=c1># Q5_K_M: Balanced quality/size (~10GB for 14B model)</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>./llama.cpp/build/bin/llama-quantize<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=w>  </span>--imatrix<span class=w> </span>gguf_outputs/model-imatrix.dat<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=w>  </span>gguf_outputs/model-merged-f16.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=w>  </span>gguf_outputs/model-q5_k_m.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=w>  </span>Q5_K_M
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=c1># Q4_K_M: Recommended for most users (~8GB for 14B model)</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>./llama.cpp/build/bin/llama-quantize<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=w>  </span>--imatrix<span class=w> </span>gguf_outputs/model-imatrix.dat<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=w>  </span>gguf_outputs/model-merged-f16.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a><span class=w>  </span>gguf_outputs/model-q4_k_m.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=w>  </span>Q4_K_M
</span></code></pre></div> <h3 id=3-quantization-options-reference>3. Quantization Options Reference<a class=headerlink href=#3-quantization-options-reference title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Quantization</th> <th>Bits per Weight</th> <th>Quality</th> <th>Use Case</th> </tr> </thead> <tbody> <tr> <td>Q8_0</td> <td>~8.0</td> <td>Highest</td> <td>Production, quality critical</td> </tr> <tr> <td>Q6_K</td> <td>~6.6</td> <td>High</td> <td>Production, balanced</td> </tr> <tr> <td>Q5_K_M</td> <td>~5.5</td> <td>Good</td> <td>Most users</td> </tr> <tr> <td>Q4_K_M</td> <td>~4.3</td> <td>Acceptable</td> <td>Resource constrained</td> </tr> </tbody> </table> <h2 id=experimental-quantizations>Experimental Quantizations<a class=headerlink href=#experimental-quantizations title="Permanent link">&para;</a></h2> <p><strong>Warning</strong>: These quantizations achieve extreme compression but may significantly impact model quality.</p> <h3 id=ultra-low-bit-quantizations>Ultra-Low Bit Quantizations<a class=headerlink href=#ultra-low-bit-quantizations title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># IQ2_XXS: Extreme compression (~4GB for 14B model)</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>./llama.cpp/build/bin/llama-quantize<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>  </span>--imatrix<span class=w> </span>gguf_outputs/model-imatrix.dat<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>  </span>gguf_outputs/model-merged-f16.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>  </span>gguf_outputs/model-iq2_xxs.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>  </span>IQ2_XXS
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=c1># TQ1_0: Ternary quantization (~3.7GB for 14B model)</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>./llama.cpp/build/bin/llama-quantize<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>  </span>--imatrix<span class=w> </span>gguf_outputs/model-imatrix.dat<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>  </span>gguf_outputs/model-merged-f16.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>  </span>gguf_outputs/model-tq1_0.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>  </span>TQ1_0
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=c1># IQ1_S: Maximum compression (~3.4GB for 14B model)</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>./llama.cpp/build/bin/llama-quantize<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>  </span>--imatrix<span class=w> </span>gguf_outputs/model-imatrix.dat<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=w>  </span>gguf_outputs/model-merged-f16.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>  </span>gguf_outputs/model-iq1_s.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=w>  </span>IQ1_S
</span></code></pre></div> <h3 id=experimental-quantization-reference>Experimental Quantization Reference<a class=headerlink href=#experimental-quantization-reference title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Quantization</th> <th>Bits per Weight</th> <th>Compression</th> <th>Warning Level</th> </tr> </thead> <tbody> <tr> <td>IQ2_XXS</td> <td>2.06</td> <td>85% smaller</td> <td>Moderate quality loss</td> </tr> <tr> <td>TQ1_0</td> <td>1.69</td> <td>87% smaller</td> <td>High quality loss</td> </tr> <tr> <td>IQ1_S</td> <td>1.56</td> <td>88% smaller</td> <td>Severe quality loss</td> </tr> </tbody> </table> <h2 id=quality-testing>Quality Testing<a class=headerlink href=#quality-testing title="Permanent link">&para;</a></h2> <h3 id=1-quick-functionality-test>1. Quick Functionality Test<a class=headerlink href=#1-quick-functionality-test title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># Test standard quantization</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>./llama.cpp/build/bin/llama-cli<span class=w> </span><span class=se>\</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>  </span>-m<span class=w> </span>gguf_outputs/model-q4_k_m.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>  </span>-p<span class=w> </span><span class=s2>&quot;Your test prompt here&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>  </span>-n<span class=w> </span><span class=m>100</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>  </span>--verbose
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=c1># Test experimental quantization</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>./llama.cpp/build/bin/llama-cli<span class=w> </span><span class=se>\</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>  </span>-m<span class=w> </span>gguf_outputs/model-iq1_s.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>  </span>-p<span class=w> </span><span class=s2>&quot;Your test prompt here&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>  </span>-n<span class=w> </span><span class=m>100</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>  </span>--verbose
</span></code></pre></div> <h3 id=2-perplexity-evaluation>2. Perplexity Evaluation<a class=headerlink href=#2-perplexity-evaluation title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># Download evaluation dataset</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>wget<span class=w> </span>https://s3.amazonaws.com/research.metamind.io/wikitext/wikitext-2-raw-v1.zip
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>unzip<span class=w> </span>wikitext-2-raw-v1.zip
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=c1># Test perplexity (lower is better)</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>./llama.cpp/build/bin/llama-perplexity<span class=w> </span><span class=se>\</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>  </span>-m<span class=w> </span>gguf_outputs/model-q4_k_m.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>  </span>-f<span class=w> </span>wikitext-2-raw/wiki.test.raw<span class=w> </span><span class=se>\</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=w>  </span>-ngl<span class=w> </span><span class=m>32</span>
</span></code></pre></div> <h3 id=3-size-verification>3. Size Verification<a class=headerlink href=#3-size-verification title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># Check all quantization sizes</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>ls<span class=w> </span>-lh<span class=w> </span>gguf_outputs/*.gguf
</span></code></pre></div> <p><strong>Expected output</strong> (14B model):</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>28G  model-merged-f16.gguf
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>15G  model-q8_0.gguf
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>12G  model-q6_k.gguf
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>10G  model-q5_k_m.gguf
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>8.4G model-q4_k_m.gguf
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>4.1G model-iq2_xxs.gguf
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>3.7G model-tq1_0.gguf
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>3.4G model-iq1_s.gguf
</span></code></pre></div> <h2 id=ollama-integration>Ollama Integration<a class=headerlink href=#ollama-integration title="Permanent link">&para;</a></h2> <p>Ollama provides an easy way to run your quantized models locally with a simple API interface.</p> <h3 id=installation-and-setup>Installation and Setup<a class=headerlink href=#installation-and-setup title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># Install Ollama (Linux/macOS)</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>curl<span class=w> </span>-fsSL<span class=w> </span>https://ollama.ai/install.sh<span class=w> </span><span class=p>|</span><span class=w> </span>sh
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=c1># Or download from https://ollama.ai for Windows</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=c1># Start Ollama service (runs in background)</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>ollama<span class=w> </span>serve
</span></code></pre></div> <h3 id=creating-modelfiles-for-different-quantizations>Creating Modelfiles for Different Quantizations<a class=headerlink href=#creating-modelfiles-for-different-quantizations title="Permanent link">&para;</a></h3> <p><strong>Q4_K_M (Recommended) - Modelfile:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>cat<span class=w> </span>&gt;<span class=w> </span>Modelfile.q4<span class=w> </span><span class=s>&lt;&lt; &#39;EOF&#39;</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=s>FROM ./gguf_outputs/model-q4_k_m.gguf</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=s># System prompt for your specific use case</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=s>SYSTEM &quot;&quot;&quot;You are a linguist and translator specializing in Ugandan languages, made by Sunbird AI.&quot;&quot;&quot;</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=s># Chat template (adjust for your base model architecture)</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=s>TEMPLATE &quot;&quot;&quot;&lt;|im_start|&gt;system</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=s>{{ .System }}&lt;|im_end|&gt;</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=s>&lt;|im_start|&gt;user</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=s>{{ .Prompt }}&lt;|im_end|&gt;</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=s>&lt;|im_start|&gt;assistant</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=s>{{ .Response }}&lt;|im_end|&gt;&quot;&quot;&quot;</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=s># Stop tokens</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=s>PARAMETER stop &quot;&lt;|im_start|&gt;&quot;</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=s>PARAMETER stop &quot;&lt;|im_end|&gt;&quot;</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=s># Generation parameters</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=s>PARAMETER temperature 0.3</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=s>PARAMETER top_p 0.95</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=s>PARAMETER top_k 40</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=s>PARAMETER repeat_penalty 1.1</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=s>PARAMETER num_ctx 4096</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=s>PARAMETER num_predict 500</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=s>EOF</span>
</span></code></pre></div> <p><strong>Experimental IQ1_S - Modelfile:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>cat<span class=w> </span>&gt;<span class=w> </span>Modelfile.iq1s<span class=w> </span><span class=s>&lt;&lt; &#39;EOF&#39;</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=s>FROM ./gguf_outputs/model-iq1_s.gguf</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=s>SYSTEM &quot;&quot;&quot;You are a translator for Ugandan languages. Note: This is an experimental ultra-compressed model - quality may be limited.&quot;&quot;&quot;</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=s># Same template and parameters as above</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=s>TEMPLATE &quot;&quot;&quot;&lt;|im_start|&gt;system</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=s>{{ .System }}&lt;|im_end|&gt;</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=s>&lt;|im_start|&gt;user</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=s>{{ .Prompt }}&lt;|im_end|&gt;</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=s>&lt;|im_start|&gt;assistant</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=s>{{ .Response }}&lt;|im_end|&gt;&quot;&quot;&quot;</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=s>PARAMETER stop &quot;&lt;|im_start|&gt;&quot;</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=s>PARAMETER stop &quot;&lt;|im_end|&gt;&quot;</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=s>PARAMETER temperature 0.3</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=s>PARAMETER top_p 0.95</span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=s>PARAMETER num_ctx 2048  # Smaller context for experimental model</span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=s>EOF</span>
</span></code></pre></div> <h3 id=importing-models-to-ollama>Importing Models to Ollama<a class=headerlink href=#importing-models-to-ollama title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1># Import Q4_K_M model (recommended)</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-14b:q4<span class=w> </span>-f<span class=w> </span>Modelfile.q4
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=c1># Import experimental IQ1_S model</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-14b:iq1s<span class=w> </span>-f<span class=w> </span>Modelfile.iq1s
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=c1># Import other quantizations</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-14b:q5<span class=w> </span>-f<span class=w> </span>Modelfile.q5
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-14b:q6<span class=w> </span>-f<span class=w> </span>Modelfile.q6
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=c1># Verify models are imported</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>ollama<span class=w> </span>list
</span></code></pre></div> <p><strong>Expected output:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>NAME                    ID              SIZE    MODIFIED
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>sunflower-14b:q4        abc123def       8.4GB   2 minutes ago
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>sunflower-14b:iq1s      def456ghi       3.4GB   1 minute ago
</span></code></pre></div> <h3 id=using-ollama-models>Using Ollama Models<a class=headerlink href=#using-ollama-models title="Permanent link">&para;</a></h3> <p><strong>Interactive Chat:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1># Start interactive session with Q4 model</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:q4
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=c1># Example conversation:</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=c1># &gt;&gt;&gt; Translate to Luganda: Hello, how are you today?</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=c1># &gt;&gt;&gt; Give a dictionary definition of the Samia term &quot;ovulwaye&quot; in English</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=c1># &gt;&gt;&gt; /bye (to exit)</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=c1># Start with experimental model</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:iq1s
</span></code></pre></div> <p><strong>Single Prompt Inference:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># Quick translation with Q4 model</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:q4<span class=w> </span><span class=s2>&quot;Translate to Luganda: People in villages rarely accept new technologies.&quot;</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=c1># Test experimental model</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:iq1s<span class=w> </span><span class=s2>&quot;Translate to Luganda: Good morning&quot;</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=c1># Dictionary definition</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:q4<span class=w> </span><span class=s1>&#39;Give a dictionary definition of the Samia term &quot;ovulwaye&quot; in English&#39;</span>
</span></code></pre></div> <h3 id=ollama-api-usage>Ollama API Usage<a class=headerlink href=#ollama-api-usage title="Permanent link">&para;</a></h3> <p><strong>Start API Server:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1># Ollama automatically serves API on http://localhost:11434</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=c1># Test API endpoint</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>curl<span class=w> </span>http://localhost:11434/api/version
</span></code></pre></div> <p><strong>Python API Client:</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=k>def</span><span class=w> </span><span class=nf>translate_with_ollama</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>target_lang</span><span class=o>=</span><span class=s2>&quot;Luganda&quot;</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=s2>&quot;sunflower-14b:q4&quot;</span><span class=p>):</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>    <span class=n>url</span> <span class=o>=</span> <span class=s2>&quot;http://localhost:11434/api/generate&quot;</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>    <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>        <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=n>model</span><span class=p>,</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>        <span class=s2>&quot;prompt&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Translate to </span><span class=si>{</span><span class=n>target_lang</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>text</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>        <span class=s2>&quot;stream&quot;</span><span class=p>:</span> <span class=kc>False</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>    <span class=p>}</span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>payload</span><span class=p>)</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s2>&quot;response&quot;</span><span class=p>]</span>
</span><span id=__span-22-15><a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>
</span><span id=__span-22-16><a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=c1># Test translation</span>
</span><span id=__span-22-17><a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=n>result</span> <span class=o>=</span> <span class=n>translate_with_ollama</span><span class=p>(</span><span class=s2>&quot;Hello, how are you?&quot;</span><span class=p>)</span>
</span><span id=__span-22-18><a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span><span id=__span-22-19><a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a>
</span><span id=__span-22-20><a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a><span class=c1># Test experimental model</span>
</span><span id=__span-22-21><a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a><span class=n>result_experimental</span> <span class=o>=</span> <span class=n>translate_with_ollama</span><span class=p>(</span>
</span><span id=__span-22-22><a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a>    <span class=s2>&quot;Good morning&quot;</span><span class=p>,</span>
</span><span id=__span-22-23><a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a>    <span class=n>model</span><span class=o>=</span><span class=s2>&quot;sunflower-14b:iq1s&quot;</span>
</span><span id=__span-22-24><a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a><span class=p>)</span>
</span><span id=__span-22-25><a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Experimental model:&quot;</span><span class=p>,</span> <span class=n>result_experimental</span><span class=p>)</span>
</span></code></pre></div> <p><strong>curl API Examples:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># Basic translation</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:11434/api/generate<span class=w> </span><span class=se>\</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=s1>    &quot;model&quot;: &quot;sunflower-14b:q4&quot;,</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=s1>    &quot;prompt&quot;: &quot;Translate to Luganda: How are you today?&quot;,</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=s1>    &quot;stream&quot;: false</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=s1>  }&#39;</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=c1># Streaming response</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:11434/api/generate<span class=w> </span><span class=se>\</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=s1>    &quot;model&quot;: &quot;sunflower-14b:q4&quot;,</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=s1>    &quot;prompt&quot;: &quot;Translate to Luganda: People in villages rarely accept new technologies.&quot;,</span>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=s1>    &quot;stream&quot;: true</span>
</span><span id=__span-23-17><a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=s1>  }&#39;</span>
</span></code></pre></div> <h3 id=model-management>Model Management<a class=headerlink href=#model-management title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># List all models</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>ollama<span class=w> </span>list
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=c1># Show model details</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>ollama<span class=w> </span>show<span class=w> </span>sunflower-14b:q4
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=c1># Remove a model</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>ollama<span class=w> </span>rm<span class=w> </span>sunflower-14b:iq1s
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=c1># Copy model with new name</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>ollama<span class=w> </span>cp<span class=w> </span>sunflower-14b:q4<span class=w> </span>sunflower-translator
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=c1># Pull/push to Ollama registry (if you publish there)</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=c1># ollama push sunflower-14b:q4</span>
</span></code></pre></div> <h3 id=performance-comparison-script>Performance Comparison Script<a class=headerlink href=#performance-comparison-script title="Permanent link">&para;</a></h3> <p>Create <code>test_models.py</code>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=kn>import</span><span class=w> </span><span class=nn>time</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=n>models</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;sunflower-14b:q4&quot;</span><span class=p>,</span> <span class=s2>&quot;sunflower-14b:iq1s&quot;</span><span class=p>]</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=n>test_prompt</span> <span class=o>=</span> <span class=s2>&quot;Translate to Luganda: Hello, how are you today?&quot;</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=k>def</span><span class=w> </span><span class=nf>test_model</span><span class=p>(</span><span class=n>model_name</span><span class=p>,</span> <span class=n>prompt</span><span class=p>):</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;http://localhost:11434/api/generate&quot;</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a>        <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=n>model_name</span><span class=p>,</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a>        <span class=s2>&quot;prompt&quot;</span><span class=p>:</span> <span class=n>prompt</span><span class=p>,</span>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a>        <span class=s2>&quot;stream&quot;</span><span class=p>:</span> <span class=kc>False</span>
</span><span id=__span-25-14><a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a>    <span class=p>})</span>
</span><span id=__span-25-15><a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a>
</span><span id=__span-25-16><a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a>    <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-25-17><a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-25-18><a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a>
</span><span id=__span-25-19><a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-25-20><a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a>        <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=n>model_name</span><span class=p>,</span>
</span><span id=__span-25-21><a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a>        <span class=s2>&quot;response&quot;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=s2>&quot;response&quot;</span><span class=p>],</span>
</span><span id=__span-25-22><a id=__codelineno-25-22 name=__codelineno-25-22 href=#__codelineno-25-22></a>        <span class=s2>&quot;time&quot;</span><span class=p>:</span> <span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>,</span>
</span><span id=__span-25-23><a id=__codelineno-25-23 name=__codelineno-25-23 href=#__codelineno-25-23></a>        <span class=s2>&quot;tokens&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&quot;response&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>())</span>
</span><span id=__span-25-24><a id=__codelineno-25-24 name=__codelineno-25-24 href=#__codelineno-25-24></a>    <span class=p>}</span>
</span><span id=__span-25-25><a id=__codelineno-25-25 name=__codelineno-25-25 href=#__codelineno-25-25></a>
</span><span id=__span-25-26><a id=__codelineno-25-26 name=__codelineno-25-26 href=#__codelineno-25-26></a><span class=c1># Test all models</span>
</span><span id=__span-25-27><a id=__codelineno-25-27 name=__codelineno-25-27 href=#__codelineno-25-27></a><span class=k>for</span> <span class=n>model</span> <span class=ow>in</span> <span class=n>models</span><span class=p>:</span>
</span><span id=__span-25-28><a id=__codelineno-25-28 name=__codelineno-25-28 href=#__codelineno-25-28></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>test_model</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>test_prompt</span><span class=p>)</span>
</span><span id=__span-25-29><a id=__codelineno-25-29 name=__codelineno-25-29 href=#__codelineno-25-29></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Model: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;model&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-25-30><a id=__codelineno-25-30 name=__codelineno-25-30 href=#__codelineno-25-30></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Response: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;response&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-25-31><a id=__codelineno-25-31 name=__codelineno-25-31 href=#__codelineno-25-31></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Time: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>s&quot;</span><span class=p>)</span>
</span><span id=__span-25-32><a id=__codelineno-25-32 name=__codelineno-25-32 href=#__codelineno-25-32></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Tokens: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;tokens&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-25-33><a id=__codelineno-25-33 name=__codelineno-25-33 href=#__codelineno-25-33></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;-&quot;</span> <span class=o>*</span> <span class=mi>50</span><span class=p>)</span>
</span></code></pre></div> <h3 id=production-deployment>Production Deployment<a class=headerlink href=#production-deployment title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1># Create production Modelfile with optimized settings</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>cat<span class=w> </span>&gt;<span class=w> </span>Modelfile.production<span class=w> </span><span class=s>&lt;&lt; &#39;EOF&#39;</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=s>FROM ./gguf_outputs/model-q4_k_m.gguf</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=s>SYSTEM &quot;&quot;&quot;You are a professional translator for Ugandan languages, made by Sunbird AI. Provide accurate, contextually appropriate translations.&quot;&quot;&quot;</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=s>TEMPLATE &quot;&quot;&quot;&lt;|im_start|&gt;system</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=s>{{ .System }}&lt;|im_end|&gt;</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=s>&lt;|im_start|&gt;user</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=s>{{ .Prompt }}&lt;|im_end|&gt;</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=s>&lt;|im_start|&gt;assistant</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=s>{{ .Response }}&lt;|im_end|&gt;&quot;&quot;&quot;</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=s>PARAMETER stop &quot;&lt;|im_start|&gt;&quot;</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=s>PARAMETER stop &quot;&lt;|im_end|&gt;&quot;</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a>
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=s># Production-optimized parameters</span>
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=s>PARAMETER temperature 0.1        # Lower for consistency</span>
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=s>PARAMETER top_p 0.9             # Slightly more focused</span>
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=s>PARAMETER repeat_penalty 1.05   # Minimal repetition penalty</span>
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=s>PARAMETER num_ctx 4096          # Full context</span>
</span><span id=__span-26-22><a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a><span class=s>PARAMETER num_predict 200       # Reasonable response length</span>
</span><span id=__span-26-23><a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=s>EOF</span>
</span><span id=__span-26-24><a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a>
</span><span id=__span-26-25><a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=c1># Create production model</span>
</span><span id=__span-26-26><a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-translator:production<span class=w> </span>-f<span class=w> </span>Modelfile.production
</span></code></pre></div> <h2 id=distribution>Distribution<a class=headerlink href=#distribution title="Permanent link">&para;</a></h2> <h3 id=1-hugging-face-upload>1. Hugging Face Upload<a class=headerlink href=#1-hugging-face-upload title="Permanent link">&para;</a></h3> <p>Create upload script <code>upload_models.py</code>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=ch>#!/usr/bin/env python3</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=kn>from</span><span class=w> </span><span class=nn>huggingface_hub</span><span class=w> </span><span class=kn>import</span> <span class=n>HfApi</span><span class=p>,</span> <span class=n>login</span><span class=p>,</span> <span class=n>create_repo</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=k>def</span><span class=w> </span><span class=nf>upload_gguf_models</span><span class=p>():</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>    <span class=n>repo_id</span> <span class=o>=</span> <span class=s2>&quot;your-org/your-model-GGUF&quot;</span>  <span class=c1># Update this</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>    <span class=n>local_folder</span> <span class=o>=</span> <span class=s2>&quot;gguf_outputs&quot;</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>    <span class=c1># Login and create repository</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>    <span class=n>login</span><span class=p>()</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a>    <span class=n>api</span> <span class=o>=</span> <span class=n>HfApi</span><span class=p>()</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a>    <span class=n>create_repo</span><span class=p>(</span><span class=n>repo_id</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>repo_type</span><span class=o>=</span><span class=s2>&quot;model&quot;</span><span class=p>)</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a>    <span class=c1># Upload all files</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>    <span class=n>api</span><span class=o>.</span><span class=n>upload_folder</span><span class=p>(</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a>        <span class=n>folder_path</span><span class=o>=</span><span class=n>local_folder</span><span class=p>,</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a>        <span class=n>repo_id</span><span class=o>=</span><span class=n>repo_id</span><span class=p>,</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a>        <span class=n>allow_patterns</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;*.gguf&quot;</span><span class=p>,</span> <span class=s2>&quot;*.dat&quot;</span><span class=p>],</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a>        <span class=n>commit_message</span><span class=o>=</span><span class=s2>&quot;Add GGUF quantized models&quot;</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a>    <span class=p>)</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Upload complete: https://huggingface.co/</span><span class=si>{</span><span class=n>repo_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a>
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span>
</span><span id=__span-27-23><a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a>    <span class=n>upload_gguf_models</span><span class=p>()</span>
</span></code></pre></div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1># Login to Hugging Face</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>huggingface-cli<span class=w> </span>login
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=c1># Run upload</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>python<span class=w> </span>upload_models.py
</span></code></pre></div> <h3 id=2-ollama-integration-complete-guide>2. Ollama Integration (Complete Guide)<a class=headerlink href=#2-ollama-integration-complete-guide title="Permanent link">&para;</a></h3> <h4 id=installation-and-setup_1>Installation and Setup<a class=headerlink href=#installation-and-setup_1 title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1># Install Ollama (Linux/macOS)</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>curl<span class=w> </span>-fsSL<span class=w> </span>https://ollama.ai/install.sh<span class=w> </span><span class=p>|</span><span class=w> </span>sh
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=c1># Or download from https://ollama.ai for Windows</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=c1># Start Ollama service (runs in background)</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a>ollama<span class=w> </span>serve
</span></code></pre></div> <h4 id=creating-modelfiles-for-different-quantizations_1>Creating Modelfiles for Different Quantizations<a class=headerlink href=#creating-modelfiles-for-different-quantizations_1 title="Permanent link">&para;</a></h4> <p><strong>Q4_K_M (Recommended) - Modelfile:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>cat<span class=w> </span>&gt;<span class=w> </span>Modelfile.q4<span class=w> </span><span class=s>&lt;&lt; &#39;EOF&#39;</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=s>FROM ./gguf_outputs/model-q4_k_m.gguf</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=s># System prompt for your specific use case</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=s>SYSTEM &quot;&quot;&quot;You are a linguist and translator specializing in Ugandan languages, made by Sunbird AI.&quot;&quot;&quot;</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=s># Chat template (adjust for your base model architecture)</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=s>TEMPLATE &quot;&quot;&quot;&lt;|im_start|&gt;system</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=s>{{ .System }}&lt;|im_end|&gt;</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=s>&lt;|im_start|&gt;user</span>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=s>{{ .Prompt }}&lt;|im_end|&gt;</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=s>&lt;|im_start|&gt;assistant</span>
</span><span id=__span-30-13><a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=s>{{ .Response }}&lt;|im_end|&gt;&quot;&quot;&quot;</span>
</span><span id=__span-30-14><a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a>
</span><span id=__span-30-15><a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=s># Stop tokens</span>
</span><span id=__span-30-16><a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a><span class=s>PARAMETER stop &quot;&lt;|im_start|&gt;&quot;</span>
</span><span id=__span-30-17><a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a><span class=s>PARAMETER stop &quot;&lt;|im_end|&gt;&quot;</span>
</span><span id=__span-30-18><a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a>
</span><span id=__span-30-19><a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=s># Generation parameters</span>
</span><span id=__span-30-20><a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a><span class=s>PARAMETER temperature 0.3</span>
</span><span id=__span-30-21><a id=__codelineno-30-21 name=__codelineno-30-21 href=#__codelineno-30-21></a><span class=s>PARAMETER top_p 0.95</span>
</span><span id=__span-30-22><a id=__codelineno-30-22 name=__codelineno-30-22 href=#__codelineno-30-22></a><span class=s>PARAMETER top_k 40</span>
</span><span id=__span-30-23><a id=__codelineno-30-23 name=__codelineno-30-23 href=#__codelineno-30-23></a><span class=s>PARAMETER repeat_penalty 1.1</span>
</span><span id=__span-30-24><a id=__codelineno-30-24 name=__codelineno-30-24 href=#__codelineno-30-24></a><span class=s>PARAMETER num_ctx 4096</span>
</span><span id=__span-30-25><a id=__codelineno-30-25 name=__codelineno-30-25 href=#__codelineno-30-25></a><span class=s>PARAMETER num_predict 500</span>
</span><span id=__span-30-26><a id=__codelineno-30-26 name=__codelineno-30-26 href=#__codelineno-30-26></a><span class=s>EOF</span>
</span></code></pre></div> <p><strong>Experimental IQ1_S - Modelfile:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>cat<span class=w> </span>&gt;<span class=w> </span>Modelfile.iq1s<span class=w> </span><span class=s>&lt;&lt; &#39;EOF&#39;</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=s>FROM ./gguf_outputs/model-iq1_s.gguf</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=s>SYSTEM &quot;&quot;&quot;You are a translator for Ugandan languages. Note: This is an experimental ultra-compressed model - quality may be limited.&quot;&quot;&quot;</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=s># Same template and parameters as above</span>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=s>TEMPLATE &quot;&quot;&quot;&lt;|im_start|&gt;system</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=s>{{ .System }}&lt;|im_end|&gt;</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=s>&lt;|im_start|&gt;user</span>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=s>{{ .Prompt }}&lt;|im_end|&gt;</span>
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=s>&lt;|im_start|&gt;assistant</span>
</span><span id=__span-31-12><a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a><span class=s>{{ .Response }}&lt;|im_end|&gt;&quot;&quot;&quot;</span>
</span><span id=__span-31-13><a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a>
</span><span id=__span-31-14><a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a><span class=s>PARAMETER stop &quot;&lt;|im_start|&gt;&quot;</span>
</span><span id=__span-31-15><a id=__codelineno-31-15 name=__codelineno-31-15 href=#__codelineno-31-15></a><span class=s>PARAMETER stop &quot;&lt;|im_end|&gt;&quot;</span>
</span><span id=__span-31-16><a id=__codelineno-31-16 name=__codelineno-31-16 href=#__codelineno-31-16></a><span class=s>PARAMETER temperature 0.3</span>
</span><span id=__span-31-17><a id=__codelineno-31-17 name=__codelineno-31-17 href=#__codelineno-31-17></a><span class=s>PARAMETER top_p 0.95</span>
</span><span id=__span-31-18><a id=__codelineno-31-18 name=__codelineno-31-18 href=#__codelineno-31-18></a><span class=s>PARAMETER num_ctx 2048  # Smaller context for experimental model</span>
</span><span id=__span-31-19><a id=__codelineno-31-19 name=__codelineno-31-19 href=#__codelineno-31-19></a><span class=s>EOF</span>
</span></code></pre></div> <h4 id=importing-models-to-ollama_1>Importing Models to Ollama<a class=headerlink href=#importing-models-to-ollama_1 title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1># Import Q4_K_M model (recommended)</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-14b:q4<span class=w> </span>-f<span class=w> </span>Modelfile.q4
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=c1># Import experimental IQ1_S model</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-14b:iq1s<span class=w> </span>-f<span class=w> </span>Modelfile.iq1s
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=c1># Import other quantizations</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-14b:q5<span class=w> </span>-f<span class=w> </span>Modelfile.q5
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-14b:q6<span class=w> </span>-f<span class=w> </span>Modelfile.q6
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=c1># Verify models are imported</span>
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a>ollama<span class=w> </span>list
</span></code></pre></div> <p><strong>Expected output:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>NAME                    ID              SIZE    MODIFIED
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>sunflower-14b:q4        abc123def       8.4GB   2 minutes ago
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>sunflower-14b:iq1s      def456ghi       3.4GB   1 minute ago
</span></code></pre></div> <h4 id=using-ollama-models_1>Using Ollama Models<a class=headerlink href=#using-ollama-models_1 title="Permanent link">&para;</a></h4> <p><strong>Interactive Chat:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1># Start interactive session with Q4 model</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:q4
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=c1># Example conversation:</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=c1># &gt;&gt;&gt; Translate to Luganda: Hello, how are you today?</span>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=c1># &gt;&gt;&gt; Give a dictionary definition of the Samia term &quot;ovulwaye&quot; in English</span>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=c1># &gt;&gt;&gt; /bye (to exit)</span>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a>
</span><span id=__span-34-9><a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a><span class=c1># Start with experimental model</span>
</span><span id=__span-34-10><a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:iq1s
</span></code></pre></div> <p><strong>Single Prompt Inference:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=c1># Quick translation with Q4 model</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:q4<span class=w> </span><span class=s2>&quot;Translate to Luganda: People in villages rarely accept new technologies.&quot;</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=c1># Test experimental model</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:iq1s<span class=w> </span><span class=s2>&quot;Translate to Luganda: Good morning&quot;</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a>
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=c1># Dictionary definition</span>
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:q4<span class=w> </span><span class=s1>&#39;Give a dictionary definition of the Samia term &quot;ovulwaye&quot; in English&#39;</span>
</span></code></pre></div> <h4 id=ollama-api-usage_1>Ollama API Usage<a class=headerlink href=#ollama-api-usage_1 title="Permanent link">&para;</a></h4> <p><strong>Start API Server:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1># Ollama automatically serves API on http://localhost:11434</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=c1># Test API endpoint</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>curl<span class=w> </span>http://localhost:11434/api/version
</span></code></pre></div> <p><strong>Python API Client:</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=k>def</span><span class=w> </span><span class=nf>translate_with_ollama</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>target_lang</span><span class=o>=</span><span class=s2>&quot;Luganda&quot;</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=s2>&quot;sunflower-14b:q4&quot;</span><span class=p>):</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>    <span class=n>url</span> <span class=o>=</span> <span class=s2>&quot;http://localhost:11434/api/generate&quot;</span>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a>    <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a>        <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=n>model</span><span class=p>,</span>
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a>        <span class=s2>&quot;prompt&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Translate to </span><span class=si>{</span><span class=n>target_lang</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>text</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a>        <span class=s2>&quot;stream&quot;</span><span class=p>:</span> <span class=kc>False</span>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a>    <span class=p>}</span>
</span><span id=__span-37-12><a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a>
</span><span id=__span-37-13><a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>payload</span><span class=p>)</span>
</span><span id=__span-37-14><a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s2>&quot;response&quot;</span><span class=p>]</span>
</span><span id=__span-37-15><a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a>
</span><span id=__span-37-16><a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a><span class=c1># Test translation</span>
</span><span id=__span-37-17><a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a><span class=n>result</span> <span class=o>=</span> <span class=n>translate_with_ollama</span><span class=p>(</span><span class=s2>&quot;Hello, how are you?&quot;</span><span class=p>)</span>
</span><span id=__span-37-18><a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span><span id=__span-37-19><a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a>
</span><span id=__span-37-20><a id=__codelineno-37-20 name=__codelineno-37-20 href=#__codelineno-37-20></a><span class=c1># Test experimental model</span>
</span><span id=__span-37-21><a id=__codelineno-37-21 name=__codelineno-37-21 href=#__codelineno-37-21></a><span class=n>result_experimental</span> <span class=o>=</span> <span class=n>translate_with_ollama</span><span class=p>(</span>
</span><span id=__span-37-22><a id=__codelineno-37-22 name=__codelineno-37-22 href=#__codelineno-37-22></a>    <span class=s2>&quot;Good morning&quot;</span><span class=p>,</span>
</span><span id=__span-37-23><a id=__codelineno-37-23 name=__codelineno-37-23 href=#__codelineno-37-23></a>    <span class=n>model</span><span class=o>=</span><span class=s2>&quot;sunflower-14b:iq1s&quot;</span>
</span><span id=__span-37-24><a id=__codelineno-37-24 name=__codelineno-37-24 href=#__codelineno-37-24></a><span class=p>)</span>
</span><span id=__span-37-25><a id=__codelineno-37-25 name=__codelineno-37-25 href=#__codelineno-37-25></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Experimental model:&quot;</span><span class=p>,</span> <span class=n>result_experimental</span><span class=p>)</span>
</span></code></pre></div> <p><strong>curl API Examples:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=c1># Basic translation</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:11434/api/generate<span class=w> </span><span class=se>\</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=s1>    &quot;model&quot;: &quot;sunflower-14b:q4&quot;,</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=s1>    &quot;prompt&quot;: &quot;Translate to Luganda: How are you today?&quot;,</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=s1>    &quot;stream&quot;: false</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=s1>  }&#39;</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=c1># Streaming response</span>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:11434/api/generate<span class=w> </span><span class=se>\</span>
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{</span>
</span><span id=__span-38-14><a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=s1>    &quot;model&quot;: &quot;sunflower-14b:q4&quot;,</span>
</span><span id=__span-38-15><a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=s1>    &quot;prompt&quot;: &quot;Translate to Luganda: People in villages rarely accept new technologies.&quot;,</span>
</span><span id=__span-38-16><a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a><span class=s1>    &quot;stream&quot;: true</span>
</span><span id=__span-38-17><a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a><span class=s1>  }&#39;</span>
</span></code></pre></div> <h4 id=model-management_1>Model Management<a class=headerlink href=#model-management_1 title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=c1># List all models</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>ollama<span class=w> </span>list
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=c1># Show model details</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>ollama<span class=w> </span>show<span class=w> </span>sunflower-14b:q4
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=c1># Remove a model</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a>ollama<span class=w> </span>rm<span class=w> </span>sunflower-14b:iq1s
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=c1># Copy model with new name</span>
</span><span id=__span-39-11><a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a>ollama<span class=w> </span>cp<span class=w> </span>sunflower-14b:q4<span class=w> </span>sunflower-translator
</span><span id=__span-39-12><a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a>
</span><span id=__span-39-13><a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=c1># Pull/push to Ollama registry (if you publish there)</span>
</span><span id=__span-39-14><a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a><span class=c1># ollama push sunflower-14b:q4</span>
</span></code></pre></div> <h4 id=performance-comparison-script_1>Performance Comparison Script<a class=headerlink href=#performance-comparison-script_1 title="Permanent link">&para;</a></h4> <p>Create <code>test_models.py</code>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=kn>import</span><span class=w> </span><span class=nn>time</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=n>models</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;sunflower-14b:q4&quot;</span><span class=p>,</span> <span class=s2>&quot;sunflower-14b:iq1s&quot;</span><span class=p>]</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=n>test_prompt</span> <span class=o>=</span> <span class=s2>&quot;Translate to Luganda: Hello, how are you today?&quot;</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=k>def</span><span class=w> </span><span class=nf>test_model</span><span class=p>(</span><span class=n>model_name</span><span class=p>,</span> <span class=n>prompt</span><span class=p>):</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;http://localhost:11434/api/generate&quot;</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a>        <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=n>model_name</span><span class=p>,</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a>        <span class=s2>&quot;prompt&quot;</span><span class=p>:</span> <span class=n>prompt</span><span class=p>,</span>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a>        <span class=s2>&quot;stream&quot;</span><span class=p>:</span> <span class=kc>False</span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a>    <span class=p>})</span>
</span><span id=__span-40-15><a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a>
</span><span id=__span-40-16><a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a>    <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-40-17><a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-40-18><a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a>
</span><span id=__span-40-19><a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-40-20><a id=__codelineno-40-20 name=__codelineno-40-20 href=#__codelineno-40-20></a>        <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=n>model_name</span><span class=p>,</span>
</span><span id=__span-40-21><a id=__codelineno-40-21 name=__codelineno-40-21 href=#__codelineno-40-21></a>        <span class=s2>&quot;response&quot;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=s2>&quot;response&quot;</span><span class=p>],</span>
</span><span id=__span-40-22><a id=__codelineno-40-22 name=__codelineno-40-22 href=#__codelineno-40-22></a>        <span class=s2>&quot;time&quot;</span><span class=p>:</span> <span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>,</span>
</span><span id=__span-40-23><a id=__codelineno-40-23 name=__codelineno-40-23 href=#__codelineno-40-23></a>        <span class=s2>&quot;tokens&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&quot;response&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>())</span>
</span><span id=__span-40-24><a id=__codelineno-40-24 name=__codelineno-40-24 href=#__codelineno-40-24></a>    <span class=p>}</span>
</span><span id=__span-40-25><a id=__codelineno-40-25 name=__codelineno-40-25 href=#__codelineno-40-25></a>
</span><span id=__span-40-26><a id=__codelineno-40-26 name=__codelineno-40-26 href=#__codelineno-40-26></a><span class=c1># Test all models</span>
</span><span id=__span-40-27><a id=__codelineno-40-27 name=__codelineno-40-27 href=#__codelineno-40-27></a><span class=k>for</span> <span class=n>model</span> <span class=ow>in</span> <span class=n>models</span><span class=p>:</span>
</span><span id=__span-40-28><a id=__codelineno-40-28 name=__codelineno-40-28 href=#__codelineno-40-28></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>test_model</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>test_prompt</span><span class=p>)</span>
</span><span id=__span-40-29><a id=__codelineno-40-29 name=__codelineno-40-29 href=#__codelineno-40-29></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Model: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;model&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-40-30><a id=__codelineno-40-30 name=__codelineno-40-30 href=#__codelineno-40-30></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Response: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;response&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-40-31><a id=__codelineno-40-31 name=__codelineno-40-31 href=#__codelineno-40-31></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Time: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>s&quot;</span><span class=p>)</span>
</span><span id=__span-40-32><a id=__codelineno-40-32 name=__codelineno-40-32 href=#__codelineno-40-32></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Tokens: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;tokens&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-40-33><a id=__codelineno-40-33 name=__codelineno-40-33 href=#__codelineno-40-33></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;-&quot;</span> <span class=o>*</span> <span class=mi>50</span><span class=p>)</span>
</span></code></pre></div> <h4 id=troubleshooting-ollama>Troubleshooting Ollama<a class=headerlink href=#troubleshooting-ollama title="Permanent link">&para;</a></h4> <p><strong>Common Issues:</strong></p> <ol> <li><strong>Model fails to load:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1># Check model file exists</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>ls<span class=w> </span>-la<span class=w> </span>gguf_outputs/model-q4_k_m.gguf
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=c1># Verify Modelfile syntax</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-14b:q4<span class=w> </span>-f<span class=w> </span>Modelfile.q4<span class=w> </span>--verbose
</span></code></pre></div> <ol> <li><strong>Out of memory:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=c1># Use smaller quantization</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:iq1s<span class=w>  </span><span class=c1># Uses only 3.4GB</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=c1># Or reduce context size in Modelfile</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>PARAMETER<span class=w> </span>num_ctx<span class=w> </span><span class=m>2048</span>
</span></code></pre></div> <ol> <li><strong>Poor quality with experimental models:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=c1># Compare outputs</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:q4<span class=w> </span><span class=s2>&quot;Your test prompt&quot;</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:iq1s<span class=w> </span><span class=s2>&quot;Your test prompt&quot;</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=c1># Expected: IQ1_S may have degraded quality</span>
</span></code></pre></div> <ol> <li><strong>Ollama service not running:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1># Start service</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>ollama<span class=w> </span>serve
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=c1># Or check if running</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a>ps<span class=w> </span>aux<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>ollama
</span></code></pre></div> <h4 id=production-deployment_1>Production Deployment<a class=headerlink href=#production-deployment_1 title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=c1># Create production Modelfile with optimized settings</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>cat<span class=w> </span>&gt;<span class=w> </span>Modelfile.production<span class=w> </span><span class=s>&lt;&lt; &#39;EOF&#39;</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=s>FROM ./gguf_outputs/model-q4_k_m.gguf</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=s>SYSTEM &quot;&quot;&quot;You are a professional translator for Ugandan languages, made by Sunbird AI. Provide accurate, contextually appropriate translations.&quot;&quot;&quot;</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=s>TEMPLATE &quot;&quot;&quot;&lt;|im_start|&gt;system</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=s>{{ .System }}&lt;|im_end|&gt;</span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=s>&lt;|im_start|&gt;user</span>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=s>{{ .Prompt }}&lt;|im_end|&gt;</span>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=s>&lt;|im_start|&gt;assistant</span>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=s>{{ .Response }}&lt;|im_end|&gt;&quot;&quot;&quot;</span>
</span><span id=__span-45-13><a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a>
</span><span id=__span-45-14><a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a><span class=s>PARAMETER stop &quot;&lt;|im_start|&gt;&quot;</span>
</span><span id=__span-45-15><a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a><span class=s>PARAMETER stop &quot;&lt;|im_end|&gt;&quot;</span>
</span><span id=__span-45-16><a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a>
</span><span id=__span-45-17><a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a><span class=s># Production-optimized parameters</span>
</span><span id=__span-45-18><a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a><span class=s>PARAMETER temperature 0.1        # Lower for consistency</span>
</span><span id=__span-45-19><a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a><span class=s>PARAMETER top_p 0.9             # Slightly more focused</span>
</span><span id=__span-45-20><a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a><span class=s>PARAMETER repeat_penalty 1.05   # Minimal repetition penalty</span>
</span><span id=__span-45-21><a id=__codelineno-45-21 name=__codelineno-45-21 href=#__codelineno-45-21></a><span class=s>PARAMETER num_ctx 4096          # Full context</span>
</span><span id=__span-45-22><a id=__codelineno-45-22 name=__codelineno-45-22 href=#__codelineno-45-22></a><span class=s>PARAMETER num_predict 200       # Reasonable response length</span>
</span><span id=__span-45-23><a id=__codelineno-45-23 name=__codelineno-45-23 href=#__codelineno-45-23></a><span class=s>EOF</span>
</span><span id=__span-45-24><a id=__codelineno-45-24 name=__codelineno-45-24 href=#__codelineno-45-24></a>
</span><span id=__span-45-25><a id=__codelineno-45-25 name=__codelineno-45-25 href=#__codelineno-45-25></a><span class=c1># Create production model</span>
</span><span id=__span-45-26><a id=__codelineno-45-26 name=__codelineno-45-26 href=#__codelineno-45-26></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-translator:production<span class=w> </span>-f<span class=w> </span>Modelfile.production
</span></code></pre></div> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <h3 id=common-issues>Common Issues<a class=headerlink href=#common-issues title="Permanent link">&para;</a></h3> <p><strong>1. Out of Memory During Merge</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=c1># Use smaller precision or CPU offloading</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=nb>export</span><span class=w> </span><span class=nv>PYTORCH_CUDA_ALLOC_CONF</span><span class=o>=</span>max_split_size_mb:512
</span></code></pre></div> <p><strong>2. GGUF Conversion Fails</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=c1># Check model architecture compatibility</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a>python3<span class=w> </span>llama.cpp/convert_hf_to_gguf.py<span class=w> </span>models/merged_model<span class=w> </span>--outfile<span class=w> </span>test.gguf<span class=w> </span>--dry-run
</span></code></pre></div> <p><strong>3. Quantization Too Slow</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=c1># Use fewer threads or disable imatrix for testing</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>./llama.cpp/build/bin/llama-quantize<span class=w> </span><span class=se>\</span>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=w>  </span>gguf_outputs/model-merged-f16.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=w>  </span>gguf_outputs/model-q4_k_m.gguf<span class=w> </span><span class=se>\</span>
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=w>  </span>Q4_K_M<span class=w> </span><span class=se>\</span>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=w>  </span><span class=m>4</span><span class=w>  </span><span class=c1># Use 4 threads</span>
</span></code></pre></div> <p><strong>4. Experimental Quantizations Unusable</strong></p> <ul> <li>This is expected for extreme quantizations like IQ1_S</li> <li>Test with your specific use case</li> <li>Consider using IQ2_XXS as minimum viable quantization</li> </ul> <h3 id=file-size-expectations>File Size Expectations<a class=headerlink href=#file-size-expectations title="Permanent link">&para;</a></h3> <p>For a 14B parameter model:</p> <ul> <li><strong>Merge process</strong>: Requires 2x model size in RAM (~56GB peak)</li> <li><strong>F16 GGUF</strong>: ~28GB final size</li> <li><strong>Quantized models</strong>: 3GB-15GB depending on level</li> <li><strong>Total storage needed</strong>: ~200GB for all quantizations</li> </ul> <h3 id=performance-notes>Performance Notes<a class=headerlink href=#performance-notes title="Permanent link">&para;</a></h3> <ul> <li><strong>Importance matrix generation</strong>: 30-60 minutes on modern hardware</li> <li><strong>Each quantization</strong>: 5-10 minutes per model</li> <li><strong>Upload time</strong>: Varies by connection, large files use Git LFS</li> <li><strong>Memory usage</strong>: Peaks during merge, lower during quantization</li> </ul> <h3 id=ollama-specific-issues>Ollama-Specific Issues<a class=headerlink href=#ollama-specific-issues title="Permanent link">&para;</a></h3> <p><strong>1. Model fails to load:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=c1># Check model file exists</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a>ls<span class=w> </span>-la<span class=w> </span>gguf_outputs/model-q4_k_m.gguf
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=c1># Verify Modelfile syntax</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a>ollama<span class=w> </span>create<span class=w> </span>sunflower-14b:q4<span class=w> </span>-f<span class=w> </span>Modelfile.q4<span class=w> </span>--verbose
</span></code></pre></div> <p><strong>2. Out of memory with Ollama:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=c1># Use smaller quantization</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:iq1s<span class=w>  </span><span class=c1># Uses only 3.4GB</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=c1># Or reduce context size in Modelfile</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a>PARAMETER<span class=w> </span>num_ctx<span class=w> </span><span class=m>2048</span>
</span></code></pre></div> <p><strong>3. Poor quality with experimental models:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=c1># Compare outputs</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:q4<span class=w> </span><span class=s2>&quot;Your test prompt&quot;</span>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a>ollama<span class=w> </span>run<span class=w> </span>sunflower-14b:iq1s<span class=w> </span><span class=s2>&quot;Your test prompt&quot;</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=c1># Expected: IQ1_S may have degraded quality</span>
</span></code></pre></div> <p><strong>4. Ollama service not running:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=c1># Start service</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>ollama<span class=w> </span>serve
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=c1># Or check if running</span>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a>ps<span class=w> </span>aux<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>ollama
</span></code></pre></div> <p><strong>5. API connection issues:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=c1># Test API availability</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a>curl<span class=w> </span>http://localhost:11434/api/version
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=c1># Check if port is blocked</span>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a>netstat<span class=w> </span>-tlnp<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=m>11434</span>
</span></code></pre></div> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">&para;</a></h2> <p>This tutorial demonstrates the complete pipeline for converting LoRA fine-tuned models to GGUF format with multiple quantization levels. The process enables deployment of large models on resource-constrained hardware while maintaining various quality/size trade-offs.</p> <p>The experimental ultra-low quantizations (IQ1_S, IQ2_XXS, TQ1_0) push the boundaries of model compression and should be used with appropriate quality expectations.</p> <p>For production use, Q4_K_M provides the best balance of quality and size, while Q5_K_M and Q6_K offer better quality at larger sizes. Always evaluate quantized models on your specific tasks before deployment.</p> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">&para;</a></h2> <ul> <li><a href=https://github.com/ggml-org/llama.cpp>llama.cpp Repository</a></li> <li><a href=https://github.com/ggerganov/ggml/blob/master/docs/gguf.md>GGUF Format Specification</a></li> <li><a href=https://huggingface.co/docs/peft>PEFT Library Documentation</a></li> <li><a href=https://huggingface.co/docs/hub>Hugging Face Hub Documentation</a></li> </ul> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../inference/ class="md-footer__link md-footer__link--prev" aria-label="Previous: inference"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> inference </div> </div> </a> <a href=../../tutorials/04-basics/ class="md-footer__link md-footer__link--next" aria-label="Next: Basics"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Basics </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.instant.prefetch", "navigation.sections", "navigation.path", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>